# =============================================================================
# Tmux Configuration — Phat Nguyen
# Tmux 3.5a | Docs: man tmux
# =============================================================================

# -----------------------------------------------------------------------------
# Server Options (set -s)
# These affect the tmux server process itself
# -----------------------------------------------------------------------------

# Default TERM inside tmux — enables 256 colors and italics
# Use "tmux-256color" (best) or "screen-256color" (wider compat)
set -s default-terminal "tmux-256color"

# Time (ms) tmux waits after Esc to determine if it's part of a sequence
# Low value = snappy vi-mode switching (default: 500, too sluggish)
set -s escape-time 10

# Send focus-in/out events to programs inside tmux (e.g., Vim autoread)
# Requires terminal support (Alacritty supports this)
set -s focus-events on

# Clipboard access via OSC 52 escape sequences
# "on" = allow apps to set clipboard, "external" = also allow reading,
# "off" = disable (default: external)
set -s set-clipboard external

# Enable extended keys (modifyOtherKeys / CSI u) for better key detection
# "on" = always, "off" = never, "always" = even if app doesn't request
# (default: off)
# set -s extended-keys on

# Terminal features — modern tmux 3.2+ way to declare capabilities
# Declares true color (RGB) + other features Alacritty supports
set -sa terminal-features ",alacritty:RGB:clipboard:ccolour:cstyle:focus:title"

# Fallback: enable true color for xterm-256color terminals too
set -sa terminal-overrides ",xterm-256color:RGB"

# Max number of paste buffers (default: 50)
# set -s buffer-limit 50

# Max messages in message log (default: 1000)
# set -s message-limit 1000

# Prompt history entries to retain (default: 100)
# set -s prompt-history-limit 100

# Path to save/load command history across sessions
# set -s history-file "~/.tmux_history"

# External clipboard command (for copy-pipe, etc.)
# set -s copy-command "xclip -selection clipboard"

# Default editor for edit commands (default: $EDITOR or vi)
# set -s editor nvim

# -----------------------------------------------------------------------------
# Session Options (set -g)
# These affect all sessions unless overridden per-session
# -----------------------------------------------------------------------------

# Shell to use for new panes/windows (default: $SHELL)
set -g default-shell /usr/bin/zsh

# Command to run in new windows (default: "" = login shell from default-shell)
# set -g default-command ""

# Scrollback buffer — lines of history per pane (default: 2000)
set -g history-limit 10000

# Enable mouse support — click panes, resize panes, scroll, select text
# (default: off)
set -g mouse on

# Start window numbering from 1 instead of 0 (default: 0)
set -g base-index 1

# Auto-renumber windows when one is closed (e.g., closing window 2
# makes window 3 become window 2) (default: off)
set -g renumber-windows on

# Default window size for new sessions (default: 80x24)
# set -g default-size "80x24"

# Time (ms) pane numbers are displayed with display-panes (default: 1000)
# set -g display-panes-time 1000

# Color of pane numbers (display-panes command)
# set -g display-panes-colour blue
# set -g display-panes-active-colour red

# Time (ms) status line messages are displayed (default: 750)
set -g display-time 750

# What to do when a session is destroyed: "off" = detach client,
# "on" = switch to another session, "no-detached" = switch only to attached
# (default: on)
set -g detach-on-destroy on

# Set terminal title via escape sequences (default: off)
# set -g set-titles on
# set -g set-titles-string "#S:#I:#W - \"#T\" #{session_alerts}"

# Lock tmux after N seconds of inactivity (0 = disabled) (default: 0)
# set -g lock-after-time 0
# set -g lock-command "lock -np"

# Action on activity/bell/silence in a non-current window
# "any" = activity in any window, "none" = ignore, "current" = only current,
# "other" = only other windows (default: "other" for activity/silence, "any" for bell)
set -g activity-action other
set -g bell-action any
set -g silence-action other

# Visual notification for activity/bell/silence
# "off" = no notification, "on" = status message, "both" = message + bell passthrough
# (default: off)
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off

# Characters considered word separators for word selection (default: includes
# punctuation). Modify if double-click selection grabs too much/little.
# set -g word-separators "!\"#$%&'()*+,-./:;<=>?@[\\]^`{|}~"

# Environment variables to update when attaching from a different environment
# (default: DISPLAY KRB5CCNAME SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID
#  SSH_CONNECTION WINDOWID XAUTHORITY)
# set -g update-environment "DISPLAY SSH_AUTH_SOCK SSH_AGENT_PID"

# Key bindings mode for the status line prompt: "vi" | "emacs" (default: emacs)
set -g status-keys vi

# -----------------------------------------------------------------------------
# Status Bar
# -----------------------------------------------------------------------------

# Show status bar: "on" | "off" | "2" | "3" etc. for multi-line (default: on)
set -g status on

# Position: "top" | "bottom" (default: bottom)
set -g status-position bottom

# Window list alignment: "left" | "centre" | "right"
#   "absolute-centre" = centre of entire status line (default: left)
set -g status-justify left

# Refresh interval in seconds (default: 15)
# Lower = more frequent updates for clocks/system info, higher CPU
set -g status-interval 5

# Global status bar style
set -g status-style "bg=default"

# Note: status-fg is deprecated in favor of status-style, but still works
# Consider moving to: set -g status-style "bg=default,fg=colour244"
set -g status-fg colour244

# --- Left side ---

# Max length of the left section (default: 10)
set -g status-left-length 10
set -g status-left-style default
set -g status-left " "

# --- Right side ---

# Max length of the right section (default: 40)
set -g status-right-length 300
set -g status-right-style default

# Format variables: #h = hostname, #S = session, #I = window index,
# #W = window name, #T = pane title, #(cmd) = shell command output,
# %Y-%m-%d %H:%M:%S = date/time
set -g status-right "#[fg=color109]#h | #[fg=color244]#(cat /proc/meminfo | awk '/MemTotal/ {total=$2/1024/1024} /MemAvailable/ {available=$2/1024/1024} END {used=(total-available); printf \"%.2fG\/%.2fG\", used, total}') | #(ip addr | grep -e 'state UP' -A 2 | awk '/inet /{printf $2}') | #[fg=colour210, bold]%Y-%m-%d %H:%M:%S "

# --- Message bar style (e.g., when running :command) ---
# set -g message-style "bg=yellow,fg=black"
# set -g message-command-style "bg=black,fg=yellow"

# Which status line messages appear on (0-indexed) (default: 0)
# set -g message-line 0

# -----------------------------------------------------------------------------
# Window Options (setw -g)
# These affect all windows unless overridden per-window
# -----------------------------------------------------------------------------

# Vi-style keys in copy mode (default: emacs)
setw -g mode-keys vi

# Start pane numbering from 1 (matches base-index for consistency)
setw -g pane-base-index 1

# Auto-rename window to the currently running command (default: on)
setw -g automatic-rename on

# Format for automatic rename (default: shows command name or [tmux] in copy mode)
# setw -g automatic-rename-format "#{?pane_in_mode,[tmux],#{pane_current_command}}#{?pane_dead,[dead],}"

# Allow programs inside panes to rename the window via escape sequences (default: off)
# setw -g allow-rename off

# Allow programs to set the pane title (default: on)
# setw -g allow-set-title on

# Allow passthrough escape sequences (for images, custom escapes) (default: off)
# "on" = allow, "all" = allow from all panes (default: off)
# setw -g allow-passthrough off

# Monitor for activity in other windows — highlights in status bar (default: off)
setw -g monitor-activity off

# Monitor for bell in other windows (default: on)
setw -g monitor-bell on

# Seconds of silence before triggering silence alert (0 = disabled) (default: 0)
# setw -g monitor-silence 0

# Resize windows aggressively — shrink to smallest attached client
# viewing that window, not smallest client of the session (default: off)
# setw -g aggressive-resize on

# How tmux determines window size with multiple clients:
# "largest" | "smallest" | "manual" | "latest" (default: latest)
# setw -g window-size latest

# Enable alternate screen (apps like vim restore terminal on exit) (default: on)
# setw -g alternate-screen on

# Clear scrollback on Ctrl+L (default: on)
# setw -g scroll-on-clear on

# Wrap around when searching in copy mode (default: on)
# setw -g wrap-search on

# Synchronize input to all panes in a window (default: off)
# setw -g synchronize-panes off

# Clock mode (prefix + t)
# setw -g clock-mode-colour blue
# setw -g clock-mode-style 24

# --- Window status format (how each window tab looks) ---

# Separator between window entries in the status line (default: " ")
setw -g window-status-separator " "

# Current (active) window format and style
setw -g window-status-current-format "#[fg=colour180, bold][#I] #W "
setw -g window-status-current-style "fg=colour180 bg=colour0"

# Inactive window format and style
setw -g window-status-format "[#I] #W "
setw -g window-status-style "fg=colour244 bg=colour0"

# Last active window style (default: default)
# setw -g window-status-last-style default

# Style for windows with activity/bell alerts
# setw -g window-status-activity-style reverse
# setw -g window-status-bell-style reverse

# --- Copy mode styles ---
# setw -g mode-style "bg=yellow,fg=black"
# setw -g copy-mode-match-style "bg=cyan,fg=black"
# setw -g copy-mode-current-match-style "bg=magenta,fg=black"
# setw -g copy-mode-mark-style "bg=red,fg=black"

# --- Pane styles ---
# Default style for all panes vs active pane (for dimming inactive panes)
# setw -g window-style default
# setw -g window-active-style default

# --- Cursor ---
# Override cursor color/style in tmux (default: none/default = inherit)
# setw -g cursor-colour none
# setw -g cursor-style default

# --- Menu/Popup styles ---
# setw -g menu-style default
# setw -g menu-selected-style "bg=yellow,fg=black"
# setw -g menu-border-style default
# setw -g menu-border-lines single
# setw -g popup-style default
# setw -g popup-border-style default
# setw -g popup-border-lines single

# Keep pane open after process exits (default: off)
# setw -g remain-on-exit off

# Fill character for unused areas (default: "")
# setw -g fill-character ''

# Layout dimensions for main-horizontal / main-vertical layouts
# setw -g main-pane-height 24
# setw -g main-pane-width 80

# -----------------------------------------------------------------------------
# Pane Borders
# -----------------------------------------------------------------------------

# Inactive pane border color
set -g pane-border-style "fg=colour238"

# Active pane border color
set -g pane-active-border-style "bg=default fg=colour235"

# Border line style: "single" | "double" | "heavy" | "simple" |
# "number" | "padded" (default: single)
# set -g pane-border-lines single

# What indicates the active pane: "off" | "colour" | "arrows" | "both"
# (default: colour)
# set -g pane-border-indicators colour

# Show pane info in borders: "off" | "top" | "bottom" (default: off)
# set -g pane-border-status off

# Format string for pane border status
# set -g pane-border-format "#{?pane_active,#[reverse],}#{pane_index}#[default] \"#{pane_title}\""

# -----------------------------------------------------------------------------
# Prefix Key
# -----------------------------------------------------------------------------

# Primary prefix key (default: C-b)
set -g prefix C-b

# Secondary prefix key (default: None)
# set -g prefix2 None

# Send the prefix key to the inner program (for nested tmux)
bind C-b send-prefix

# Alternative prefix (uncomment to use Ctrl+Space instead):
# set -g prefix C-Space
# bind C-Space send-prefix
# unbind C-b

# -----------------------------------------------------------------------------
# Key Bindings
# Flags: -n = no prefix needed, -r = repeatable (within repeat-time)
# repeat-time = ms window for repeatable keys (default: 500)
# -----------------------------------------------------------------------------

set -g repeat-time 500

# --- Unbind arrow keys (we use vim keys instead) ---
unbind Up
unbind Down
unbind Left
unbind Right

# --- Split panes ---
# \ = horizontal split (side by side), - = vertical split (top/bottom)
# -c "#{pane_current_path}" preserves the working directory
bind '\' split-window -h -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"

# --- Reload config ---
bind r source-file ~/.tmux.conf \; display "TMUX reloaded"

# --- Window switching with Alt+Number (no prefix needed) ---
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# --- Zoom pane toggle with Alt+Shift+K (no prefix needed) ---
bind -n M-K resize-pane -Z

# --- Vim-like pane switching (prefix + h/j/k/l, repeatable) ---
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

# --- Resize panes (prefix + Shift+H/J/K/L, repeatable, 5 cells at a time) ---
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# --- Copy mode vi bindings ---
# Enter copy mode: prefix + [
# Begin selection: v, copy selection: y, rectangle toggle: Ctrl+v
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# --- Useful extras (uncomment to enable) ---

# Create new window preserving current path
# bind c new-window -c "#{pane_current_path}"

# Swap panes
# bind > swap-pane -D
# bind < swap-pane -U

# Move windows left/right
# bind -r C-h swap-window -t -1 \; select-window -t -1
# bind -r C-l swap-window -t +1 \; select-window -t +1

# Break pane into a new window / join pane from another window
# bind ! break-pane
# bind @ command-prompt -p "join pane from:" "join-pane -s '%%'"

# Toggle synchronize-panes (type in all panes at once)
# bind S setw synchronize-panes \; display "Sync #{?synchronize-panes,ON,OFF}"

# Clear screen and scrollback
# bind C-k send-keys C-l \; clear-history

# Quick session switching
# bind s choose-tree -sZ
